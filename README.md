# תיקוני מערכת ההתראות - גרסה 2.1

## סיכום הבעיות שתוקנו

### 1. התראות קופצות גם כשעובדים על משימה
**בעיה:** מנהל ההתראות לא זיהה שיש טיימר פעיל ושלח התראות על משימות אחרות.

**פתרון:** 
- הוספת פונקציה `getActiveTimerInfo()` שמזהה גם טיימר רץ וגם טיימר מושהה
- כשיש טיימר מושהה - לא שולחים התראות על משימות אחרות
- כשיש טיימר רץ - שולחים רק התראות על המשימה הפעילה (כמו "נשארו 5 דקות")

### 2. שעות עבודה קשיחות בקוד
**בעיה:** שעות העבודה היו קשיחות (08:30-16:15) ולא נקראו מההגדרות.

**פתרון:**
- הוספת פונקציה `getWorkHoursSettings()` שקוראת הגדרות מ-localStorage
- הממשק תומך עכשיו בדקות (לא רק שעות שלמות)
- שמירה כפולה: גם בפורמט הישן וגם בפורמט שמנהל ההתראות מחפש

### 3. אי-התאמה במפתחות localStorage
**בעיה:** הטיימר שמר לפעמים 'active' במקום ה-ID האמיתי של המשימה.

**פתרון:**
- תוקן לשמור תמיד את ה-ID האמיתי של המשימה
- הוספת בדיקה שיש `currentTask?.id` לפני שמירה

### 4. מחיקת מצב טיימר כשמשהים
**בעיה:** כשמשהים טיימר, הוא נמחק מ-`zmanit_active_timer`, ואז מנהל ההתראות חושב שאין טיימר בכלל.

**פתרון:**
- הטיימר לא נמחק כשמושהה
- מנהל ההתראות בודק את `timer_v2_` וקורא את ה-`isPaused` flag

---

## קבצים שהשתנו

### 1. `src/components/Notifications/UnifiedNotificationManager.jsx`
- פונקציה חדשה: `getActiveTimerInfo()` - מזהה טיימר רץ/מושהה
- פונקציה חדשה: `getWorkHoursSettings()` - קוראת הגדרות שעות עבודה
- לוגיקה משופרת: התראות רק כשאין טיימר כלל

### 2. `src/components/Tasks/TaskTimerWithInterruptions.jsx`
- תיקון שמירת ID (לא 'active')
- הטיימר לא נמחק כשמושהה
- ניקוי מלא רק בעצירה סופית

### 3. `src/pages/Settings.jsx`
- הגדרות שעות עבודה עם דקות (לא רק שעות שלמות)
- שמירה כפולה לתאימות עם מנהל ההתראות
- תצוגה משופרת של השעות שנבחרו

---

## התקנה

1. גבי את הקבצים הקיימים
2. העתיקי את הקבצים החדשים למקומם:
   - `src/components/Notifications/UnifiedNotificationManager.jsx`
   - `src/components/Tasks/TaskTimerWithInterruptions.jsx`
   - `src/pages/Settings.jsx`
3. רענני את האפליקציה

---

## בדיקות מומלצות

1. **התחלת טיימר** - וודאי שההתראות לא קופצות על משימות אחרות
2. **השהיית טיימר** - וודאי שלא מקבלת התראות "אין טיימר פעיל" (רק אחרי X דקות - התראת "משימה מושהית")
3. **הגדרות שעות עבודה** - שני ו-בדקי שאפשר לבחור גם 8:45 או 16:20
4. **ניקוי localStorage** - מחקי `zmanit_active_timer` ו-`zmanit_work_settings` ובדקי שהכל עובד גם בהתחלה נקייה
